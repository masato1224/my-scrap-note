---
slug: before_create_new_resource
title: 新規リソースの作成準備
tags: [terraform, aws]
description: 新規リソースを作成する際の初期設定
---

## 取り得ず必要なファイル作る

```sh
touch ./backend.tf && \
touch ./remote_state.tf && \
touch ./.terraform-version && \
touch ./provider.tf && \
touch ./variables.tf
```

## 各ファイルの記入

<details>
<summary>折りたたみ</summary>

### backend.tf

リモートステートの設定

```tf
terraform {
  backend "s3" {
    bucket  = "terraform-{{事業名}}-state"
    key     = "terraform.state.{{事業名}}.{{プロダクト名}}"
    region  = "ap-northeast-1"
    profile = "{{事業名}}"
  }
}
```

### remote_state.tf

他のリモートステートを参照する必要があれば記載する

```tf
data "terraform_remote_state" "{{名前}}" {
  backend = "s3"

  config = {
    bucket  = "{{バケット名}}"
    key     = "{{キーの名称}}"
    region  = "ap-northeast-1"
    profile = "{{事業名}}"
  }
}
## 必要な分だけ...
```

### .terraform-version

terraformのバージョン固定する

```tf
## e.g: 1.0.8
{{バージョン名}}
```

### provider.tf

プロバイダーの設定

```tf
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> {{バージョン名}}"
    }
  }
}

provider "aws" {
  region  = "ap-northeast-1"
  profile = "{{ssoログインに利用するプロファイル名}}"
  default_tags {
    tags = {
      Project         = local.project_name
      "Job code"      = local.job_code
      "terraform-env" = "{{env}}" // ここは必要があれば
    }
  }
}
```

### variables.tf

共通で使いそうな変数を定義する

```tf
locals {
  project_name = "{{事業者名 || プロダクト名}}"
  job_code     = "{{jobコード}}"
}
```

</details>

### 初期化&コミット

```sh
aws sso login --profile {{プロファイル名}}
terraform init
terraform providers lock -platform=linux_amd64 -platform=darwin_amd64 -platform=darwin_arm64
git add .
git cm '{{ first commit }}'
```

## Ref

- [terraform](https://github.com/hashicorp/terraform)
- [terraform-provider-aws](https://github.com/hashicorp/terraform-provider-aws)
